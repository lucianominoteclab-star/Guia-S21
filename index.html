<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Asistente Siglo 21</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { margin:0; font-family:Inter,sans-serif; background:#f4f6f8; display:flex; justify-content:center; height:100vh; }
.app { width:100%; max-width:900px; background:white; display:flex; flex-direction:column; }
header { background:#00953B; color:white; padding:14px 18px; font-weight:600; }
#chat { flex:1; padding:16px; overflow-y:auto; }
.msg { margin-bottom:12px; padding:10px 14px; border-radius:10px; max-width:80%; }
.user { background:#eee; margin-left:auto; }
.bot { background:#e7f4ea; border-left:4px solid #00953B; }
.system { text-align:center; color:#777; font-size:13px; }
footer { display:flex; padding:12px; border-top:1px solid #ddd; gap:10px; }
input { flex:1; padding:12px; border-radius:8px; border:1px solid #ccc; }
button { background:#00953B; color:white; border:none; padding:12px 18px; border-radius:8px; cursor:pointer; }
</style>
</head>

<body>
<div class="app">
<header>Asistente Siglo 21</header>

<div id="chat">
  <div class="system">Cargando base de informaciÃ³nâ€¦</div>
</div>

<footer>
  <input id="q" placeholder="EscribÃ­ tu consultaâ€¦">
  <button id="send">Enviar</button>
</footer>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("q");
const btn = document.getElementById("send");

// ðŸ”¥ FORZAR INPUT ACTIVO SI O SI
input.disabled = false;
btn.disabled = false;
input.readOnly = false;

function add(text, cls="system") {
  const d = document.createElement("div");
  d.className = cls === "system" ? "system" : "msg " + cls;
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function normalize(text) {
  return text.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9\s]/g, "");
}

function similarity(a, b) {
  const sa = new Set(a.split(" "));
  const sb = new Set(b.split(" "));
  let inter = 0;
  sa.forEach(w => sb.has(w) && inter++);
  return inter / Math.max(sa.size, sb.size);
}

let chunks = [];

async function init() {
  try {
    add("Inicializando sistemaâ€¦");

    // ðŸ” TEST 1
    add("Probando escritura en inputâ€¦");
    input.focus();

    // ðŸ” TEST 2
    add("Cargando data/info.txt â€¦");
    const resp = await fetch("data/info.txt", { cache: "no-store" });
    if (!resp.ok) throw new Error("No se pudo cargar data/info.txt");

    const txt = await resp.text();
    add("Archivo cargado OK");

    chunks = txt
      .split(/\n\n+/)
      .map(t => t.trim())
      .filter(t => t.length > 40)
      .map(t => ({
        raw: t,
        norm: normalize(t)
      }));

    add(`Base cargada (${chunks.length} secciones). Listo para usar.`);
  } catch (e) {
    add("âŒ ERROR: " + e.message);
    console.error(e);
  }
}

function send() {
  const q = input.value.trim();
  if (!q) return;

  input.value = "";
  add(q, "user");

  const nq = normalize(q);

  let best = null;
  let bestScore = 0;

  chunks.forEach(c => {
    const score = similarity(nq, c.norm);
    if (score > bestScore) {
      bestScore = score;
      best = c;
    }
  });

  if (!best || bestScore < 0.05) {
    add("No encontrÃ© informaciÃ³n relacionada.", "bot");
  } else {
    add(best.raw, "bot");
  }
}

btn.addEventListener("click", send);
input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

// ðŸ”¥ ARRANQUE GARANTIZADO
setTimeout(init, 100);
</script>


</body>
</html>
