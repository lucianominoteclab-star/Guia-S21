<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Asistente Siglo 21</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { margin:0; font-family:Inter,sans-serif; background:#f4f6f8; display:flex; justify-content:center; height:100vh; }
.app { width:100%; max-width:900px; background:white; display:flex; flex-direction:column; }
header { background:#00953B; color:white; padding:14px 18px; font-weight:600; }
#chat { flex:1; padding:16px; overflow-y:auto; }
.msg { margin-bottom:12px; padding:10px 14px; border-radius:10px; max-width:80%; white-space:pre-wrap; }
.user { background:#eee; margin-left:auto; }
.bot { background:#e7f4ea; border-left:4px solid #00953B; }
.system { text-align:center; color:#777; font-size:13px; }
footer { display:flex; padding:12px; border-top:1px solid #ddd; gap:10px; }
input { flex:1; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:15px; }
button { background:#00953B; color:white; border:none; padding:12px 18px; border-radius:8px; cursor:pointer; font-weight:600; }
button:hover { background:#007a31; }
</style>
</head>

<body>
<div class="app">
<header>Asistente Siglo 21</header>

<div id="chat">
  <div class="system">Cargando base de información…</div>
</div>

<footer>
  <input id="q" placeholder="Escribí tu consulta…" autocomplete="off">
  <button id="send">Enviar</button>
</footer>
</div>

<script>
// ===================== CONFIG =====================
const chat = document.getElementById("chat");
const input = document.getElementById("q");
const btn = document.getElementById("send");

// ===================== UI =====================
function add(text, cls="system") {
  const d = document.createElement("div");
  d.className = cls === "system" ? "system" : "msg " + cls;
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

// ===================== TEXT UTILS =====================
function normalize(text) {
  return text.toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9\s]/g, "");
}

// ===================== DATA =====================
let chunks = [];

// ===================== INIT =====================
async function init() {
  try {
    add("Inicializando sistema…");

    const resp = await fetch("data/info.txt", { cache: "no-store" });
    if (!resp.ok) throw new Error("No se encontró data/info.txt");

    const txt = await resp.text();

    chunks = txt
      .split(/\n\n+/)
      .map(t => t.trim())
      .filter(t => t.length > 40)
      .map(t => ({
        raw: t,
        norm: normalize(t)
      }));

    add(`Base cargada (${chunks.length} secciones). Podés preguntar.`);
    input.focus();
  } catch (e) {
    add("❌ ERROR: " + e.message);
    console.error(e);
  }
}

// ===================== SEARCH =====================
function send() {
  const q = input.value.trim();
  if (!q) return;

  input.value = "";
  add(q, "user");

  const nq = normalize(q);
  const qWords = nq.split(" ").filter(w => w.length > 1);

  let scored = chunks.map(c => {
    let score = 0;

    // 1) Frase exacta
    if (c.norm.includes(nq)) score += 6;

    // 2) Palabras (siglas pesan más)
    qWords.forEach(w => {
      if (c.norm.includes(w)) score += (w.length <= 3 ? 4 : 1);
    });

    // 3) Penalizar textos enormes
    score -= c.norm.length / 2500;

    return { ...c, score };
  });

  scored = scored
    .filter(s => s.score > 0)
    .sort((a, b) => b.score - a.score)
    .slice(0, 3);

  if (!scored.length) {
    add("No encontré información relacionada en los documentos.", "bot");
    return;
  }

  scored.forEach(s => add(s.raw, "bot"));
}

// ===================== EVENTS =====================
btn.addEventListener("click", send);
input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

// ===================== START =====================
init();
</script>

</body>
</html>
